
version: "{build}"

clone_folder: c:\gopath\src\github.com\evshiron\shitama

environment:
  GOPATH: c:\gopath
  QINIU_AK:
    secure: wix+RiWcIDAI99yNUN+faPT6DsoldpNUAlQCw1z12TQNDdzU4gd1DvOzBmpMfYSN
  QINIU_SK:
    secure: sNrdLAohg07//wbx2nc3v4UVt0ryx76Xnq6Wq7SnYYGLjroVCxofplcPqt1fXJQD

install:
  - set QTDIR=C:\Qt\5.7\mingw53_32
  - set PATH=%PATH%;%QTDIR%\bin;C:\MinGW\bin

build_script:
  - .\scripts\build_client_dist.bat %APPVEYOR_BUILD_ID% %APPVEYOR_REPO_COMMIT%

deploy:
  provider: GitHub
  release: r$(APPVEYOR_BUILD_ID)
  description: |
    Shitama r$(APPVEYOR_BUILD_ID) for $(APPVEYOR_REPO_COMMIT)
  draft: true
  prerelease: true
  auth_token:
    secure: xCaen1KT4SjLSk39zHb+F1m3KfMgHhJfRUiLxqt+rC0BkejW+kmv5iN2Oh7Druzf

artifacts:
  - path: .\dist\Shitama.7z
    name: Shitama

on_success:
  - curl -o qshell.exe http://devtools.qiniu.com/2.0.8/qshell-windows-x86.exe
  - qshell account %QINIU_AK% %QINIU_SK%
  - qshell fput shitama Shitama-r%APPVEYOR_BUILD_ID%.7z .\dist\Shitama.7z
  - qshell copy -overwrite shitama Shitama-r%APPVEYOR_BUILD_ID%.7z shitama Shitama.7z
